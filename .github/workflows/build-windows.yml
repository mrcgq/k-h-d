name: Build Windows Executable (with Console for Debugging)

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

jobs:
  build:
    runs-on: windows-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up MSYS2
        uses: msys2/setup-msys2@v2
        with:
          update: true
          # 我们继续编译64位版本，因为您的系统是64位
          install: >-
            mingw-w64-x86_64-toolchain

      - name: Compile and Link (Console Debug Version)
        shell: msys2 {0}
        run: |
          windres resource.rc -O coff -o resource.o
          mkdir -p bin
          # *** 关键改动 ***
          # 1. 移除 -mwindows, 改为 -mconsole -> 这会创建一个带命令提示符窗口的程序
          # 2. 移除 -s -> 这会保留调试符号，如果程序崩溃，错误信息可能更详细
          gcc -static -Wall -Wextra -std=c99 -finput-charset=UTF-8 -fexec-charset=GBK -Os -o bin/k-h-d-debug.exe main.c resource.o -luser32 -lkernel32 -lcomctl32 -lgdi32 -lcrypt32 -lws2_32 -lwininet -mconsole

      - name: Upload artifact
        uses: actions/upload-artifact@v4
        with:
          # 使用新名字以作区分
          name: k-h-d-windows-debug-build
          path: bin/k-h-d-debug.exe
